<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Emails</title>
    <!-- Inclusion de Bootstrap -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Inclusion de TinyMCE -->
    <script src="https://cdn.tiny.cloud/1/zsq6davmbn96ic4ggtgjelpcpu9tdogh32o9utmdnw063jf8/tinymce/5/tinymce.min.js"
        referrerpolicy="origin"></script>
    <script src="client.js"></script> <!-- Fichier JS pour les interactions client -->
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        .container {
            margin-top: 20px;
        }
        .user-list ul {
            list-style-type: none;
            padding: 0;
        }
        .user-list li {
            background: #f4f4f4;
            margin-bottom: 5px;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <!-- Section pour la création de templates -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">
                        <h2>Créer un Nouveau Template</h2>
                    </div>
                    <div class="card-body">
                        <form id="saveTemplateForm">
                            <div class="form-group">
                                <label for="templateName">Nom du Template:</label>
                                <input type="text" class="form-control" id="templateName" name="templateName" required>
                            </div>
                            <div class="form-group">
                                <label for="htmlTemplate">Éditeur de Template HTML:</label>
                                <textarea class="form-control" id="htmlTemplate" name="htmlTemplate" rows="10"></textarea>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="saveTemplate()">Enregistrer le Template</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Section pour le chargement et l'envoi des emails -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">
                        <h2>Envoyer des Emails</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="templateList">Sélectionner un Template:</label>
                            <select class="form-control" id="templateList" onchange="selectTemplate()">
                                <!-- Options seront ajoutées par JavaScript -->
                            </select>
                        </div>
                        <form id="sendEmailForm" method="post" action="/send-emails" enctype="multipart/form-data">
                            <input type="hidden" id="htmlContent" name="htmlTemplate">
                            <div class="form-group">
                                <label for="csvFile">Fichier CSV:</label>
                                <input type="file" class="form-control-file" id="csvFile" name="csvFile" accept=".csv" required onchange="loadCsvFile()">
                            </div>
                            <div class="form-group">
                                <label for="attachments">Pièces Jointes:</label>
                                <input type="file" class="form-control-file" id="attachments" name="attachments" multiple>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="submitEmailForm()">Envoyer Email</button>
                        </form>
                        <div class="user-list mt-4" id="userList">
                            <h3>Liste des Utilisateurs</h3>
                            <ul id="userListItems">
                                <!-- Liste des utilisateurs sera ajoutée par JavaScript -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Inclusion de Bootstrap JS et des dépendances Popper.js et jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        tinymce.init({
            selector: '#htmlTemplate',
            height: 300,
            menubar: false,
            plugins: 'anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount checklist mediaembed casechange export formatpainter pageembed linkchecker a11ychecker tinymcespellchecker permanentpen powerpaste advtable advcode editimage advtemplate ai mentions tinycomments tableofcontents footnotes mergetags autocorrect typography inlinecss markdown',
            toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | code | link image media table mergetags | addcomment showcomments | spellcheckdialog a11ycheck typography | align lineheight | checklist numlist bullist indent outdent | emoticons charmap | removeformat',
            tinycomments_mode: 'embedded',
            tinycomments_author: 'Author name',
            mergetags_list: [
                { value: 'First.Name', title: 'First Name' },
                { value: 'Email', title: 'Email' },
            ],
            ai_request: (request, respondWith) => respondWith.string(() => Promise.reject("See docs to implement AI Assistant")),
        });

        window.onload = () => {
            loadTemplates();
        };
    </script>
</body>
</html>
